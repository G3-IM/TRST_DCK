<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Modello 3D</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    html, body {
      margin: 0;
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
    }

    model-viewer {
      width: 100%;
      height: 100%;
      background-color: #000;
    }

    #progress {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 6px;
      background: #333;
    }

    #progress div {
      height: 100%;
      width: 0%;
      background: #fff;
      transition: width 0.2s;
    }
  </style>
</head>

<body>

<model-viewer
  id="viewer"
  src="TRST_DCK_EXI_ARC_000_original.glb"

  camera-controls
  interaction-prompt="none"

  /* ILLUMINAZIONE */
  environment-image="neutral"
  exposure="1.25"
  shadow-intensity="0.6"
  shadow-softness="0.8"
  tone-mapping="aces"

  /* QUALITÃ€ */
  loading="eager"
  reveal="auto"

>
</model-viewer>

<div id="progress"><div></div></div>

<script>
const viewer = document.querySelector('#viewer');
const progressBar = document.querySelector('#progress div');

let isDragging = false;
let lastX = 0;

/* Loader */
viewer.addEventListener('progress', (event) => {
  const progress = event.detail.totalProgress * 100;
  progressBar.style.width = progress + '%';
  if (progress === 100) {
    document.getElementById('progress').style.display = 'none';
  }
});

/* Mouse */
viewer.addEventListener('mousedown', e => {
  isDragging = true;
  lastX = e.clientX;
});

window.addEventListener('mouseup', () => {
  isDragging = false;
});

window.addEventListener('mousemove', e => {
  if (!isDragging) return;
  rotateModel(e.clientX);
});

/* Touch */
viewer.addEventListener('touchstart', e => {
  isDragging = true;
  lastX = e.touches[0].clientX;
});

viewer.addEventListener('touchend', () => {
  isDragging = false;
});

viewer.addEventListener('touchmove', e => {
  if (!isDragging) return;
  rotateModel(e.touches[0].clientX);
});

/* Rotazione solo asse Y */
function rotateModel(currentX) {
  const dx = currentX - lastX;
  let orbit = viewer.getCameraOrbit();
  let yaw = orbit.theta * (180 / Math.PI);
  let pitch = orbit.phi * (180 / Math.PI);
  let radius = orbit.radius;

  yaw -= dx * 0.2;
  viewer.cameraOrbit = `${yaw}deg ${pitch}deg ${radius}`;
  viewer.jumpCameraToGoal();

  lastX = currentX;
}
</script>

</body>
</html>
